
R version 3.0.2 (2013-09-25) -- "Frisbee Sailing"
Copyright (C) 2013 The R Foundation for Statistical Computing
Platform: x86_64-unknown-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> #$Author: sinnwell $
> #$Date: 2011/12/05 20:53:27 $
> #$Header: /projects/genetics/cvs/cvsroot/haplo.stats/test/test.haplo.cc.R,v 1.1 2011/12/05 20:53:27 sinnwell Exp $
> #$Locker:  $
> #$Log: test.haplo.cc.R,v $
> #Revision 1.1  2011/12/05 20:53:27  sinnwell
> #changed from .q to .R, to work with R check
> #
> #
> #library(genetics) or library(haplo.stats) for R
> 
> ## package: haplo.stats
> ## test script: haplo.cc
> 
> ## settings
> verbose=TRUE
> require(haplo.stats)
Loading required package: haplo.stats
> Sys.setlocale("LC_ALL", "C")
[1] "LC_CTYPE=C;LC_NUMERIC=C;LC_TIME=C;LC_COLLATE=C;LC_MONETARY=C;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C"
> Sys.getlocale()
[1] "LC_CTYPE=C;LC_NUMERIC=C;LC_TIME=C;LC_COLLATE=C;LC_MONETARY=C;LC_MESSAGES=en_US.UTF-8;LC_PAPER=en_US.UTF-8;LC_NAME=C;LC_ADDRESS=C;LC_TELEPHONE=C;LC_MEASUREMENT=en_US.UTF-8;LC_IDENTIFICATION=C"
> 
> 
> # Jason Sinnwell 3/2004
> # Mayo Clinic, Biostatistics
> 
>   if(verbose) cat("setting up data...\n")
setting up data...
>   
>   label <- c("DQB","DRB","B")
> 
>   if(exists("is.R") && is.function(is.R) && is.R()) data(hla.demo)
>   y.bin <- 1*(hla.demo$resp.cat=="low")
> 
>   geno <- as.matrix(hla.demo[,c(17,18,21:24)])
> 
>   # commented code was to check data that goes into haplo.cc
>   # and gets pasted together in the huge data.frame.
>   
>  # sink(file="results.haplo.cc.txt")  
> 
>   seed <- c(17, 53, 1, 40, 37, 0, 62, 56, 5, 52, 12, 1)
>   set.seed(seed)
> 
> #  group.hla <- haplo.group(y.bin, geno, miss.val=0, locus.label=label,
> #                         control=haplo.em.control(n.try=1))
> #  set.seed(seed)
>   if(verbose) cat("hla data \n")
hla data 
>   cc.hla <- haplo.cc(y.bin, geno, miss.val=0,locus.label=label, 
+                      control=haplo.glm.control(haplo.min.count=8,
+                        em.c=haplo.em.control()))
>   
> #merge.hla <- haplo.score.merge(cc.hla$score.lst, group.hla)
> #options(width=120)
> #cat("\nHaplo.score output\n")
> #print(cc.hla$score.lst)
> #cat("\nhaplo.group output\n")
> #print(group.hla)
> #cat("\nhaplo.score.merge output\n")
> #print(merge.hla, order.by="haplotype", digits=4)
> #cat("\nhaplo.glm output\n")
> #print(cc.hla$fit.lst)
> #cat("\nThe whole thing, haplo.cc output\n")
> #print(cc.hla, order.by="haplotype", digits=4)
>    
>   "geno.test" <- 
+   matrix(c(1., 3., 1., 2., 1., 1., 2., 2., 2., 1., 3., 2., 1., 2., 2., 1., 1., 2., 3.,
+         2., 1., 2., 1., 1., 1., 1., 1., 1., 2., 2., 2., 2., 2., 1., 1., 2.,
+         1., 2., 3., 2., 2., 1., 2., 1., 1., 2., 2., 2., 1., 1., 2., 2., 1.,
+         2., 2., 1., 1., 1., 2., 1., 1., 1., 2., 2., 1., 2., 2., 2., 1., 1.,
+         2., 1., 2., 2., 1., 1., 2., 2., 2., 1., 2., 3., 2., 2., 3., 3., 1.,
+         4., 3., 3., 2., 3., 3., 3., 2., 3., 2., 4., 2., 2., 3., 4., 3., 4.,
+         2., 2., 3., 4., 2., 2., 4., 3., 1., 4., 2., 3., 3., 3., 3., 3.)
+   , nrow = 20, ncol = 6)
> 
>   "y.test" <-  c(0., 0., 1., 1., 1., 1.,
+                1., 0., 0., 1., 1., 1., 0., 0., 1., 1., 1., 0., 1.,1.)
> 
>   locus.label <- c("A", "B", "C")
> 
>   set.seed(seed)
> 
>   if(verbose) cat("small numeric data... \n")
small numeric data... 
>   cc.test <- haplo.cc(y.test, geno.test, locus.label=locus.label,
+                       ci.prob=.95, control=haplo.glm.control(haplo.min.count=2))
Warning messages:
1: glm.fit: fitted probabilities numerically 0 or 1 occurred 
2: glm.fit: fitted probabilities numerically 0 or 1 occurred 
3: In sqrt(fit.lst$var.mat[cbind(2:ncoef, 2:ncoef)]) : NaNs produced
> 
>   geno.char <- ifelse(geno.test==1, 'A',ifelse(geno.test==2, 'T',
+                         ifelse(geno.test==3, 'G', 'C')))
> 
>   set.seed(seed)
>   if(verbose) cat("small char data with simulations... \n")
small char data with simulations... 
>   cc.char.sim <- haplo.cc(y.test, geno.char, locus.label=locus.label, 
+                           ci.prob=.90, simulate=TRUE,
+                           control = haplo.glm.control(haplo.min.count=2))
Warning messages:
1: glm.fit: fitted probabilities numerically 0 or 1 occurred 
2: glm.fit: fitted probabilities numerically 0 or 1 occurred 
>   
> 
>   print.haplo.cc(cc.hla, digits=2, nlines=40)
-------------------------------------------------------------------------------- 
                            Global Score Statistics                              
-------------------------------------------------------------------------------- 
global-stat = 29, df = 8, p-val = 0.00029

-------------------------------------------------------------------------------- 
                         Counts for Cases and Controls                           
-------------------------------------------------------------------------------- 
control    case 
    157      63 


-------------------------------------------------------------------------------- 
          Haplotype Scores, p-values, Hap-Frequencies (hf), and Odds             
                                Ratios (95% CI)                                  
-------------------------------------------------------------------------------- 
    DQB DRB  B Hap-Score   p-val pool.hf control.hf case.hf glm.eff OR.lower
147  62   2  7    -2.103 0.03546  0.0490     0.0679  0.0159     Eff   0.0138
98   51   1 35    -1.583 0.11344  0.0302     0.0376  0.0089     Eff   0.0097
78   32   4  7    -1.393 0.16349  0.0227     0.0263  0.0079     Eff   0.0047
77   32   4 62    -0.496 0.62001  0.0212     0.0191      NA     Eff   0.0517
76   32   4 60     0.028 0.97762  0.0307     0.0315  0.0238     Eff   0.0763
16   21   7 44     1.069 0.28516  0.0217     0.0175  0.0476     Eff   0.1253
52   31   4 44     2.516 0.01186  0.0285     0.0150  0.0635     Eff   0.3425
11   21   3  8     3.776 0.00016  0.1042     0.0693  0.1905    Base       NA
1    21   1  8        NA      NA  0.0023     0.0033      NA       R   0.1443
2    21  10  8        NA      NA  0.0023     0.0032      NA       R   0.1443
3    21   2 18        NA      NA  0.0023     0.0032      NA       R   0.1443
4    21   2  7        NA      NA  0.0023     0.0032      NA       R   0.1443
5    21   3 18        NA      NA  0.0046     0.0067      NA       R   0.1443
6    21   3 35        NA      NA  0.0057     0.0065      NA       R   0.1443
7    21   3 44        NA      NA  0.0036     0.0033  0.0159       R   0.1443
8    21   3 49        NA      NA  0.0023         NA      NA       R   0.1443
9    21   3 57        NA      NA  0.0024         NA      NA       R   0.1443
10   21   3 70        NA      NA  0.0023         NA      NA       R   0.1443
12   21   4 62        NA      NA  0.0045     0.0064      NA       R   0.1443
13   21   7 13        NA      NA  0.0108         NA  0.0238       R   0.1443
14   21   7 18        NA      NA  0.0025         NA      NA       R   0.1443
15   21   7 35        NA      NA  0.0024         NA  0.0079       R   0.1443
17   21   7 45        NA      NA  0.0023     0.0032      NA       R   0.1443
18   21   7 50        NA      NA  0.0045     0.0032  0.0079       R   0.1443
19   21   7 57        NA      NA  0.0023     0.0064      NA       R   0.1443
20   21   7 62        NA      NA  0.0077     0.0074      NA       R   0.1443
21   21   7  7        NA      NA  0.0141     0.0197      NA       R   0.1443
22   21   8 18        NA      NA  0.0023     0.0028      NA       R   0.1443
23   21   8 63        NA      NA  0.0023         NA      NA       R   0.1443
24   21   9 51        NA      NA  0.0023         NA      NA       R   0.1443
25   31   1 27        NA      NA  0.0045     0.0064      NA       R   0.1443
26   31  11 18        NA      NA  0.0047         NA  0.0079       R   0.1443
27   31  11 27        NA      NA  0.0062     0.0051  0.0079       R   0.1443
28   31  11 35        NA      NA  0.0175     0.0198  0.0159       R   0.1443
29   31  11 37        NA      NA  0.0070     0.0066  0.0079       R   0.1443
30   31  11 38        NA      NA  0.0070     0.0066  0.0079       R   0.1443
31   31  11 44        NA      NA  0.0103     0.0098      NA       R   0.1443
32   31  11 49        NA      NA  0.0047         NA  0.0159       R   0.1443
33   31  11 51        NA      NA  0.0111     0.0126  0.0079       R   0.1443
34   31  11 56        NA      NA  0.0023         NA  0.0079       R   0.1443
       OR OR.upper
147 0.072     0.38
98  0.086     0.76
78  0.058     0.72
77  0.281     1.53
76  0.318     1.32
16  0.661     3.48
52  1.318     5.07
11  1.000       NA
1   0.290     0.58
2   0.290     0.58
3   0.290     0.58
4   0.290     0.58
5   0.290     0.58
6   0.290     0.58
7   0.290     0.58
8   0.290     0.58
9   0.290     0.58
10  0.290     0.58
12  0.290     0.58
13  0.290     0.58
14  0.290     0.58
15  0.290     0.58
17  0.290     0.58
18  0.290     0.58
19  0.290     0.58
20  0.290     0.58
21  0.290     0.58
22  0.290     0.58
23  0.290     0.58
24  0.290     0.58
25  0.290     0.58
26  0.290     0.58
27  0.290     0.58
28  0.290     0.58
29  0.290     0.58
30  0.290     0.58
31  0.290     0.58
32  0.290     0.58
33  0.290     0.58
34  0.290     0.58
>   print.haplo.cc(cc.test, order.by="score", digits=2)
-------------------------------------------------------------------------------- 
                            Global Score Statistics                              
-------------------------------------------------------------------------------- 
global-stat = 7.8, df = 8, p-val = 0.46

-------------------------------------------------------------------------------- 
                         Counts for Cases and Controls                           
-------------------------------------------------------------------------------- 
control    case 
      7      13 


-------------------------------------------------------------------------------- 
          Haplotype Scores, p-values, Hap-Frequencies (hf), and Odds             
                                Ratios (95% CI)                                  
-------------------------------------------------------------------------------- 
   A B C Hap-Score p-val pool.hf control.hf case.hf glm.eff OR.lower      OR
11 2 2 4    -1.473  0.14 1.2e-01      0.214 7.7e-02     Eff   0.0056 2.0e-01
8  2 1 3    -0.713  0.48 1.6e-01      0.286 1.4e-01    Base       NA 1.0e+00
2  1 1 3     0.053  0.96 1.1e-01         NA 1.1e-01     Eff   0.0091 5.8e-01
7  2 1 2     0.360  0.72 9.2e-02      0.071 9.1e-02     Eff   0.0195 3.0e+00
5  1 2 3     0.361  0.72 1.2e-01      0.143 1.4e-01     Eff   0.0638 4.0e+00
1  1 1 2     1.028  0.30 8.1e-02      0.071 1.2e-01     Eff      NaN 2.8e+13
13 3 2 2     1.094  0.27 5.0e-02         NA 7.7e-02       R   0.1105 3.1e+00
4  1 2 2     1.145  0.25 1.0e-01         NA 1.3e-01     Eff   0.0973 3.4e+00
3  1 2 1        NA    NA 5.6e-06      0.071 5.7e-10    <NA>       NA      NA
6  1 2 4        NA    NA 3.2e-02      0.071 2.7e-08       R   0.1105 3.1e+00
9  2 2 1        NA    NA 5.0e-02         NA 3.8e-02       R   0.1105 3.1e+00
10 2 2 3        NA    NA 2.6e-02         NA 3.8e-02       R   0.1105 3.1e+00
12 3 1 4        NA    NA 2.5e-02      0.071      NA       R   0.1105 3.1e+00
14 3 2 3        NA    NA 2.5e-02         NA 3.8e-02       R   0.1105 3.1e+00
   OR.upper
11      7.3
8        NA
2      37.8
7     475.7
5     247.9
1       NaN
13     88.2
4     120.3
3        NA
6      88.2
9      88.2
10     88.2
12     88.2
14     88.2
>   print(cc.test, order.by="freq", digits=2)
-------------------------------------------------------------------------------- 
                            Global Score Statistics                              
-------------------------------------------------------------------------------- 
global-stat = 7.8, df = 8, p-val = 0.46

-------------------------------------------------------------------------------- 
                         Counts for Cases and Controls                           
-------------------------------------------------------------------------------- 
control    case 
      7      13 


-------------------------------------------------------------------------------- 
          Haplotype Scores, p-values, Hap-Frequencies (hf), and Odds             
                                Ratios (95% CI)                                  
-------------------------------------------------------------------------------- 
   A B C Hap-Score p-val pool.hf control.hf case.hf glm.eff OR.lower      OR
8  2 1 3    -0.713  0.48 1.6e-01      0.286 1.4e-01    Base       NA 1.0e+00
5  1 2 3     0.361  0.72 1.2e-01      0.143 1.4e-01     Eff   0.0638 4.0e+00
11 2 2 4    -1.473  0.14 1.2e-01      0.214 7.7e-02     Eff   0.0056 2.0e-01
2  1 1 3     0.053  0.96 1.1e-01         NA 1.1e-01     Eff   0.0091 5.8e-01
4  1 2 2     1.145  0.25 1.0e-01         NA 1.3e-01     Eff   0.0973 3.4e+00
7  2 1 2     0.360  0.72 9.2e-02      0.071 9.1e-02     Eff   0.0195 3.0e+00
1  1 1 2     1.028  0.30 8.1e-02      0.071 1.2e-01     Eff      NaN 2.8e+13
13 3 2 2     1.094  0.27 5.0e-02         NA 7.7e-02       R   0.1105 3.1e+00
9  2 2 1        NA    NA 5.0e-02         NA 3.8e-02       R   0.1105 3.1e+00
6  1 2 4        NA    NA 3.2e-02      0.071 2.7e-08       R   0.1105 3.1e+00
10 2 2 3        NA    NA 2.6e-02         NA 3.8e-02       R   0.1105 3.1e+00
14 3 2 3        NA    NA 2.5e-02         NA 3.8e-02       R   0.1105 3.1e+00
12 3 1 4        NA    NA 2.5e-02      0.071      NA       R   0.1105 3.1e+00
3  1 2 1        NA    NA 5.6e-06      0.071 5.7e-10    <NA>       NA      NA
   OR.upper
8        NA
5     247.9
11      7.3
2      37.8
4     120.3
7     475.7
1       NaN
13     88.2
9      88.2
6      88.2
10     88.2
14     88.2
12     88.2
3        NA
>   print(cc.test$fit.lst, digits=2)

Call:  haplo.glm(formula = y ~ geno.glm, family = binomial, data = glm.data, 
    locus.label = locus.label, control = control, miss.val = miss.val)

Coefficients:
  (Intercept)     geno.glm.1     geno.glm.2     geno.glm.4     geno.glm.5  
        -0.48          30.97          -0.54           1.23           1.38  
   geno.glm.7    geno.glm.11  geno.glm.rare  
         1.11          -1.60           1.14  

Haplotypes:
              A B C hap.freq
geno.glm.1    1 1 2    0.076
geno.glm.2    1 1 3    0.119
geno.glm.4    1 2 2    0.112
geno.glm.5    1 2 3    0.113
geno.glm.7    2 1 2    0.087
geno.glm.11   2 2 4    0.120
geno.glm.rare * * *    0.206
haplo.base    2 1 3    0.168

Degrees of Freedom:  19 Total (i.e. Null);  12 Residual

     Null Deviance:  26 
 Residual Deviance:  18 
               AIC:  34 

>   print.haplo.cc(cc.char.sim, order.by='haplotype', digits=2)
-------------------------------------------------------------------------------- 
                            Global Score Statistics                              
-------------------------------------------------------------------------------- 
global-stat = 7.8, df = 8, p-val = 0.46

-------------------------------------------------------------------------------- 
                       Global Simulation p-value Results                         
-------------------------------------------------------------------------------- 
Global sim. p-val =  0.58 
Max-Stat sim. p-val =  0.68 
Number of Simulations, Global:  1000 , Max-Stat: 1000

-------------------------------------------------------------------------------- 
                         Counts for Cases and Controls                           
-------------------------------------------------------------------------------- 
control    case 
      7      13 


-------------------------------------------------------------------------------- 
          Haplotype Scores, p-values, Hap-Frequencies (hf), and Odds             
                                Ratios (90% CI)                                  
-------------------------------------------------------------------------------- 
   A B C Hap-Score p-val sim p-val pool.hf control.hf case.hf glm.eff OR.lower
1  A A G     0.053  0.96      0.87 1.1e-01         NA 1.1e-01     Eff  1.8e-02
2  A A T     1.028  0.30      0.38 8.1e-02      0.071 1.2e-01     Eff  2.8e+13
3  A T A        NA    NA        NA 5.6e-06      0.071 5.7e-10    <NA>       NA
4  A T C        NA    NA        NA 3.2e-02      0.071 2.7e-08       R  1.9e-01
5  A T G     0.361  0.72      0.64 1.2e-01      0.143 1.4e-01     Eff  1.2e-01
6  A T T     1.145  0.25      0.24 1.0e-01         NA 1.3e-01     Eff  1.7e-01
7  G A C        NA    NA        NA 2.5e-02      0.071      NA       R  1.9e-01
8  G T G        NA    NA        NA 2.5e-02         NA 3.8e-02       R  1.9e-01
9  G T T     1.094  0.27      0.12 5.0e-02         NA 7.7e-02       R  1.9e-01
10 T A G    -0.713  0.48      0.45 1.6e-01      0.286 1.4e-01    Base       NA
11 T A T     0.360  0.72      0.72 9.2e-02      0.071 9.1e-02     Eff  4.4e-02
12 T T A        NA    NA        NA 5.0e-02         NA 3.8e-02       R  1.9e-01
13 T T C    -1.473  0.14      0.13 1.2e-01      0.214 7.7e-02     Eff  1.0e-02
14 T T G        NA    NA        NA 2.6e-02         NA 3.8e-02       R  1.9e-01
        OR OR.upper
1  5.8e-01  1.9e+01
2  2.8e+13  2.8e+13
3       NA       NA
4  3.1e+00  5.2e+01
5  4.0e+00  1.3e+02
6  3.4e+00  6.8e+01
7  3.1e+00  5.2e+01
8  3.1e+00  5.2e+01
9  3.1e+00  5.2e+01
10 1.0e+00       NA
11 3.0e+00  2.1e+02
12 3.1e+00  5.2e+01
13 2.0e-01  4.1e+00
14 3.1e+00  5.2e+01
>   print(cc.char.sim$score.lst, digits=2)
-------------------------------------------------------------------------------- 
                          Haplotype Effect Model: add                            
-------------------------------------------------------------------------------- 
-------------------------------------------------------------------------------- 
                            Global Score Statistics                              
-------------------------------------------------------------------------------- 

global-stat = 7.75, df = 8, p-val = 0.46

-------------------------------------------------------------------------------- 
                       Global Simulation p-value Results                         
-------------------------------------------------------------------------------- 

Global sim. p-val =  0.58 
Max-Stat sim. p-val =  0.68 
Number of Simulations, Global:  1000 , Max-Stat: 1000

-------------------------------------------------------------------------------- 
                           Haplotype-specific Scores                             
-------------------------------------------------------------------------------- 

     A B C Hap-Freq Hap-Score p-val sim p-val
[1,] T T C 0.12     -1.47     0.14  0.13     
[2,] T A G 0.16     -0.71     0.48  0.45     
[3,] A A G 0.11     0.05      0.96  0.87     
[4,] T A T 0.09     0.36      0.72  0.72     
[5,] A T G 0.12     0.36      0.72  0.64     
[6,] A A T 0.08     1.03      0.3   0.38     
[7,] G T T 0.05     1.09      0.27  0.12     
[8,] A T T 0.1      1.14      0.25  0.24     

>     
> 
> proc.time()
   user  system elapsed 
 45.179   0.666  45.858 
