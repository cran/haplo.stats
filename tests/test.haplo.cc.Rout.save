
R version 3.2.3 (2015-12-10) -- "Wooden Christmas-Tree"
Copyright (C) 2015 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> #$Author: sinnwell $
> #$Date: 2011/12/05 20:53:27 $
> #$Header: /projects/genetics/cvs/cvsroot/haplo.stats/test/test.haplo.cc.R,v 1.1 2011/12/05 20:53:27 sinnwell Exp $
> #$Locker:  $
> #$Log: test.haplo.cc.R,v $
> #Revision 1.1  2011/12/05 20:53:27  sinnwell
> #changed from .q to .R, to work with R check
> #
> #
> #library(genetics) or library(haplo.stats) for R
> 
> ## package: haplo.stats
> ## test script: haplo.cc
> 
> ## settings
> verbose=TRUE
> options(width=140)
> require(haplo.stats)
Loading required package: haplo.stats
> tmp <- Sys.setlocale("LC_ALL", "C")
> tmp <- Sys.getlocale()
> 
> 
> # Jason Sinnwell, created 3/2004, updated 9/2014
> # Mayo Clinic, Biostatistics
> 
>   if(verbose) cat("setting up data...\n")
setting up data...
>   
>   label <- c("DQB","DRB","B")
> 
>   if(exists("is.R") && is.function(is.R) && is.R()) data(hla.demo)
>   y.bin <- 1*(hla.demo$resp.cat=="low")
> 
>   geno <- as.matrix(hla.demo[,c(17,18,21:24)])
> 
>   # commented code was to check data that goes into haplo.cc
>   # and gets pasted together in the huge data.frame.
>   
>  # sink(file="results.haplo.cc.txt")  
> 
>   seed <- c(17, 53, 1, 40, 37, 0, 62, 56, 5, 52, 12, 1)
>   set.seed(seed)
> 
> #  group.hla <- haplo.group(y.bin, geno, miss.val=0, locus.label=label,
> #                         control=haplo.em.control(n.try=1))
> #  set.seed(seed)
>   if(verbose) cat("hla data \n")
hla data 
>   cc.hla <- haplo.cc(y.bin, geno, miss.val=0,locus.label=label, 
+                      control=haplo.glm.control(haplo.min.count=8,
+                        em.c=haplo.em.control()))
> 
> set.seed(seed)
> ntest <- 200
> geno.test <- cbind(sample(1:2, size=ntest, replace=TRUE), sample(1:2, size=100, replace=TRUE),
+            sample(2:3,size=ntest, replace=TRUE), sample(2:3, size=100, replace=TRUE),
+            sample(2:4,size=ntest, replace=TRUE, prob=c(.5,.35,.15)), sample(2:4, size=100,
+                                             replace=TRUE, prob=c(.5,.35,.15)))
> y.test <- sample(1:2,size=ntest, replace=TRUE,prob=c(.6, .4)) - 1
> 
> locus.label <- c("A", "B", "C")
> 
> set.seed(seed)
> 
> if(verbose) cat("small numeric data... \n")
small numeric data... 
> cc.test <- haplo.cc(y.test, geno.test, locus.label=locus.label,
+                   ci.prob=.95, control=haplo.glm.control(haplo.min.count=2))
> 
> 
>   locus.label <- c("A", "B", "C")
> 
>   geno.char <- ifelse(geno.test==1, 'A',ifelse(geno.test==2, 'T',
+                         ifelse(geno.test==3, 'G', 'C')))
> 
>   set.seed(seed)
>   if(verbose) cat("small char data with simulations... \n")
small char data with simulations... 
>   cc.char.sim <- haplo.cc(y.test, geno.char, locus.label=locus.label, 
+                           ci.prob=.90, simulate=FALSE,
+                           control = haplo.glm.control(haplo.min.count=4))
>   
> 
>   print.haplo.cc(cc.hla, digits=3, nlines=40)
-------------------------------------------------------------------------------------------------------------------------------------------- 
                                                          Global Score Statistics                                                            
-------------------------------------------------------------------------------------------------------------------------------------------- 
global-stat = 29.2, df = 8, p-val = 0.000292

-------------------------------------------------------------------------------------------------------------------------------------------- 
                                                       Counts for Cases and Controls                                                         
-------------------------------------------------------------------------------------------------------------------------------------------- 
control    case 
    157      63 


-------------------------------------------------------------------------------------------------------------------------------------------- 
                                 Haplotype Scores, p-values, Hap-Frequencies (hf), and Odds Ratios (95% CI)                                  
-------------------------------------------------------------------------------------------------------------------------------------------- 
    DQB DRB  B Hap-Score    p-val pool.hf control.hf case.hf glm.eff OR.lower     OR OR.upper
183  62   2  7   -2.1030 0.035462 0.04903    0.06790 0.01587     Eff  0.01382 0.0724    0.379
121  51   1 35   -1.5829 0.113441 0.03015    0.03755 0.00893     Eff  0.00972 0.0861    0.762
96   32   4  7   -1.3934 0.163488 0.02275    0.02628 0.00794     Eff  0.00466 0.0580    0.722
95   32   4 62   -0.4958 0.620014 0.02116    0.01911      NA     Eff  0.05171 0.2810    1.527
94   32   4 60    0.0281 0.977619 0.03066    0.03153 0.02381     Eff  0.07633 0.3177    1.322
17   21   7 44    1.0688 0.285160 0.02171    0.01752 0.04762     Eff  0.12532 0.6608    3.485
64   31   4 44    2.5163 0.011859 0.02849    0.01499 0.06349     Eff  0.34252 1.3176    5.068
11   21   3  8    3.7764 0.000159 0.10419    0.06932 0.19048    Base       NA 1.0000       NA
1    21   1  8        NA       NA 0.00232    0.00335      NA       R  0.14432 0.2899    0.582
2    21  10  8        NA       NA 0.00227    0.00318      NA       R  0.14432 0.2899    0.582
3    21   2 18        NA       NA 0.00227    0.00318      NA       R  0.14432 0.2899    0.582
4    21   2  7        NA       NA 0.00227    0.00318      NA       R  0.14432 0.2899    0.582
5    21   3 18        NA       NA 0.00457    0.00671      NA       R  0.14432 0.2899    0.582
6    21   3 35        NA       NA 0.00565    0.00647      NA       R  0.14432 0.2899    0.582
7    21   3 44        NA       NA 0.00360    0.00333 0.01587       R  0.14432 0.2899    0.582
8    21   3 49        NA       NA 0.00227         NA      NA       R  0.14432 0.2899    0.582
9    21   3 57        NA       NA 0.00238         NA      NA       R  0.14432 0.2899    0.582
10   21   3 70        NA       NA 0.00227         NA      NA       R  0.14432 0.2899    0.582
12   21   4 14        NA       NA      NA    0.00637      NA    <NA>       NA     NA       NA
13   21   4 62        NA       NA 0.00455    0.00637      NA       R  0.14432 0.2899    0.582
14   21   7 13        NA       NA 0.01076         NA 0.02381       R  0.14432 0.2899    0.582
15   21   7 18        NA       NA 0.00248         NA      NA       R  0.14432 0.2899    0.582
16   21   7 35        NA       NA 0.00236         NA 0.00794       R  0.14432 0.2899    0.582
18   21   7 45        NA       NA 0.00227    0.00318      NA       R  0.14432 0.2899    0.582
19   21   7 47        NA       NA      NA         NA 0.00794    <NA>       NA     NA       NA
20   21   7 50        NA       NA 0.00455    0.00318 0.00794       R  0.14432 0.2899    0.582
21   21   7 57        NA       NA 0.00227    0.00637      NA       R  0.14432 0.2899    0.582
22   21   7 62        NA       NA 0.00766    0.00738      NA       R  0.14432 0.2899    0.582
23   21   7  7        NA       NA 0.01413    0.01968      NA       R  0.14432 0.2899    0.582
24   21   8 18        NA       NA 0.00227    0.00284      NA       R  0.14432 0.2899    0.582
25   21   8 63        NA       NA 0.00227         NA      NA       R  0.14432 0.2899    0.582
26   21   8  8        NA       NA      NA    0.00353      NA    <NA>       NA     NA       NA
27   21   9 51        NA       NA 0.00227         NA      NA       R  0.14432 0.2899    0.582
28   21   9  8        NA       NA      NA         NA 0.00794    <NA>       NA     NA       NA
29   31   1 27        NA       NA 0.00455    0.00637      NA       R  0.14432 0.2899    0.582
30   31  10 39        NA       NA      NA    0.00318      NA    <NA>       NA     NA       NA
31   31  11 18        NA       NA 0.00466         NA 0.00794       R  0.14432 0.2899    0.582
32   31  11 27        NA       NA 0.00618    0.00512 0.00794       R  0.14432 0.2899    0.582
33   31  11 35        NA       NA 0.01753    0.01982 0.01587       R  0.14432 0.2899    0.582
34   31  11 37        NA       NA 0.00699    0.00661 0.00794       R  0.14432 0.2899    0.582
> #  print(cc.hla$fit.lst, digits=3)
> #  print(cc.hla$score.lst, digits=3)
>   print.haplo.cc(cc.test, order.by='score', digits=3)
-------------------------------------------------------------------------------------------------------------------------------------------- 
                                                          Global Score Statistics                                                            
-------------------------------------------------------------------------------------------------------------------------------------------- 
global-stat = 11.6, df = 11, p-val = 0.397

-------------------------------------------------------------------------------------------------------------------------------------------- 
                                                       Counts for Cases and Controls                                                         
-------------------------------------------------------------------------------------------------------------------------------------------- 
control    case 
    124      76 


-------------------------------------------------------------------------------------------------------------------------------------------- 
                                 Haplotype Scores, p-values, Hap-Frequencies (hf), and Odds Ratios (95% CI)                                  
-------------------------------------------------------------------------------------------------------------------------------------------- 
   A B C Hap-Score  p-val pool.hf control.hf  case.hf glm.eff OR.lower       OR OR.upper
3  1 2 4    -1.264 0.2062  0.0164     0.0225 1.08e-06     Eff 2.48e-08 2.48e-08 2.48e-08
8  2 2 3    -1.131 0.2580  0.0979     0.1110 7.77e-02     Eff 1.34e-01 4.81e-01 1.72e+00
2  1 2 3    -0.951 0.3414  0.0446     0.0492 3.41e-02     Eff 1.09e-01 5.51e-01 2.79e+00
5  1 3 3    -0.843 0.3992  0.0962     0.1070 7.92e-02     Eff 2.45e-01 7.27e-01 2.16e+00
9  2 2 4    -0.800 0.4239  0.0276     0.0376 1.31e-02     Eff 4.59e-02 3.70e-01 2.99e+00
6  1 3 4    -0.657 0.5111  0.0433     0.0499 3.64e-02     Eff 1.98e-01 8.10e-01 3.31e+00
4  1 3 2    -0.371 0.7106  0.1401     0.1493 1.21e-01     Eff 2.87e-01 6.97e-01 1.69e+00
11 2 3 3     0.389 0.6974  0.0813     0.0755 9.19e-02     Eff 4.02e-01 1.36e+00 4.61e+00
7  2 2 2     0.550 0.5826  0.1466     0.1415 1.52e-01    Base       NA 1.00e+00       NA
1  1 2 2     0.848 0.3966  0.1369     0.1180 1.77e-01     Eff 5.25e-01 1.44e+00 3.96e+00
10 2 3 2     1.097 0.2727  0.1289     0.1194 1.42e-01     Eff 3.51e-01 1.01e+00 2.92e+00
12 2 3 4     1.996 0.0459  0.0403     0.0190 7.55e-02     Eff 6.72e-01 3.29e+00 1.61e+01
>   print.haplo.cc(cc.test, order.by='haplotype', digits=3)
-------------------------------------------------------------------------------------------------------------------------------------------- 
                                                          Global Score Statistics                                                            
-------------------------------------------------------------------------------------------------------------------------------------------- 
global-stat = 11.6, df = 11, p-val = 0.397

-------------------------------------------------------------------------------------------------------------------------------------------- 
                                                       Counts for Cases and Controls                                                         
-------------------------------------------------------------------------------------------------------------------------------------------- 
control    case 
    124      76 


-------------------------------------------------------------------------------------------------------------------------------------------- 
                                 Haplotype Scores, p-values, Hap-Frequencies (hf), and Odds Ratios (95% CI)                                  
-------------------------------------------------------------------------------------------------------------------------------------------- 
   A B C Hap-Score  p-val pool.hf control.hf  case.hf glm.eff OR.lower       OR OR.upper
1  1 2 2     0.848 0.3966  0.1369     0.1180 1.77e-01     Eff 5.25e-01 1.44e+00 3.96e+00
2  1 2 3    -0.951 0.3414  0.0446     0.0492 3.41e-02     Eff 1.09e-01 5.51e-01 2.79e+00
3  1 2 4    -1.264 0.2062  0.0164     0.0225 1.08e-06     Eff 2.48e-08 2.48e-08 2.48e-08
4  1 3 2    -0.371 0.7106  0.1401     0.1493 1.21e-01     Eff 2.87e-01 6.97e-01 1.69e+00
5  1 3 3    -0.843 0.3992  0.0962     0.1070 7.92e-02     Eff 2.45e-01 7.27e-01 2.16e+00
6  1 3 4    -0.657 0.5111  0.0433     0.0499 3.64e-02     Eff 1.98e-01 8.10e-01 3.31e+00
7  2 2 2     0.550 0.5826  0.1466     0.1415 1.52e-01    Base       NA 1.00e+00       NA
8  2 2 3    -1.131 0.2580  0.0979     0.1110 7.77e-02     Eff 1.34e-01 4.81e-01 1.72e+00
9  2 2 4    -0.800 0.4239  0.0276     0.0376 1.31e-02     Eff 4.59e-02 3.70e-01 2.99e+00
10 2 3 2     1.097 0.2727  0.1289     0.1194 1.42e-01     Eff 3.51e-01 1.01e+00 2.92e+00
11 2 3 3     0.389 0.6974  0.0813     0.0755 9.19e-02     Eff 4.02e-01 1.36e+00 4.61e+00
12 2 3 4     1.996 0.0459  0.0403     0.0190 7.55e-02     Eff 6.72e-01 3.29e+00 1.61e+01
>   print.haplo.cc(cc.test, order.by='freq', digits=3)
-------------------------------------------------------------------------------------------------------------------------------------------- 
                                                          Global Score Statistics                                                            
-------------------------------------------------------------------------------------------------------------------------------------------- 
global-stat = 11.6, df = 11, p-val = 0.397

-------------------------------------------------------------------------------------------------------------------------------------------- 
                                                       Counts for Cases and Controls                                                         
-------------------------------------------------------------------------------------------------------------------------------------------- 
control    case 
    124      76 


-------------------------------------------------------------------------------------------------------------------------------------------- 
                                 Haplotype Scores, p-values, Hap-Frequencies (hf), and Odds Ratios (95% CI)                                  
-------------------------------------------------------------------------------------------------------------------------------------------- 
   A B C Hap-Score  p-val pool.hf control.hf  case.hf glm.eff OR.lower       OR OR.upper
7  2 2 2     0.550 0.5826  0.1466     0.1415 1.52e-01    Base       NA 1.00e+00       NA
4  1 3 2    -0.371 0.7106  0.1401     0.1493 1.21e-01     Eff 2.87e-01 6.97e-01 1.69e+00
1  1 2 2     0.848 0.3966  0.1369     0.1180 1.77e-01     Eff 5.25e-01 1.44e+00 3.96e+00
10 2 3 2     1.097 0.2727  0.1289     0.1194 1.42e-01     Eff 3.51e-01 1.01e+00 2.92e+00
8  2 2 3    -1.131 0.2580  0.0979     0.1110 7.77e-02     Eff 1.34e-01 4.81e-01 1.72e+00
5  1 3 3    -0.843 0.3992  0.0962     0.1070 7.92e-02     Eff 2.45e-01 7.27e-01 2.16e+00
11 2 3 3     0.389 0.6974  0.0813     0.0755 9.19e-02     Eff 4.02e-01 1.36e+00 4.61e+00
2  1 2 3    -0.951 0.3414  0.0446     0.0492 3.41e-02     Eff 1.09e-01 5.51e-01 2.79e+00
6  1 3 4    -0.657 0.5111  0.0433     0.0499 3.64e-02     Eff 1.98e-01 8.10e-01 3.31e+00
12 2 3 4     1.996 0.0459  0.0403     0.0190 7.55e-02     Eff 6.72e-01 3.29e+00 1.61e+01
9  2 2 4    -0.800 0.4239  0.0276     0.0376 1.31e-02     Eff 4.59e-02 3.70e-01 2.99e+00
3  1 2 4    -1.264 0.2062  0.0164     0.0225 1.08e-06     Eff 2.48e-08 2.48e-08 2.48e-08
> 
>   print.haplo.cc(cc.char.sim, digits=3)
-------------------------------------------------------------------------------------------------------------------------------------------- 
                                                          Global Score Statistics                                                            
-------------------------------------------------------------------------------------------------------------------------------------------- 
global-stat = 11.6, df = 11, p-val = 0.397

-------------------------------------------------------------------------------------------------------------------------------------------- 
                                                       Counts for Cases and Controls                                                         
-------------------------------------------------------------------------------------------------------------------------------------------- 
control    case 
    124      76 


-------------------------------------------------------------------------------------------------------------------------------------------- 
                                 Haplotype Scores, p-values, Hap-Frequencies (hf), and Odds Ratios (90% CI)                                  
-------------------------------------------------------------------------------------------------------------------------------------------- 
   A B C Hap-Score  p-val pool.hf control.hf  case.hf glm.eff OR.lower       OR OR.upper
4  A T C    -1.264 0.2062  0.0164     0.0225 1.08e-06     Eff 2.48e-08 2.48e-08 2.48e-08
11 T T G    -1.131 0.2580  0.0979     0.1110 7.77e-02     Eff 1.65e-01 4.81e-01 1.40e+00
5  A T G    -0.951 0.3414  0.0446     0.0492 3.41e-02     Eff 1.41e-01 5.51e-01 2.15e+00
2  A G G    -0.843 0.3992  0.0962     0.1070 7.92e-02     Eff 2.92e-01 7.27e-01 1.81e+00
10 T T C    -0.800 0.4239  0.0276     0.0376 1.31e-02     Eff 6.42e-02 3.70e-01 2.14e+00
1  A G C    -0.657 0.5111  0.0433     0.0499 3.64e-02     Eff 2.49e-01 8.10e-01 2.64e+00
3  A G T    -0.371 0.7106  0.1401     0.1493 1.21e-01     Eff 3.31e-01 6.97e-01 1.47e+00
8  T G G     0.389 0.6974  0.0813     0.0755 9.19e-02     Eff 4.89e-01 1.36e+00 3.79e+00
12 T T T     0.550 0.5826  0.1466     0.1415 1.52e-01    Base       NA 1.00e+00       NA
6  A T T     0.848 0.3966  0.1369     0.1180 1.77e-01     Eff 6.18e-01 1.44e+00 3.36e+00
9  T G T     1.097 0.2727  0.1289     0.1194 1.42e-01     Eff 4.16e-01 1.01e+00 2.46e+00
7  T G C     1.996 0.0459  0.0403     0.0190 7.55e-02     Eff 8.68e-01 3.29e+00 1.25e+01
>   print(cc.char.sim$fit.lst, digits=3)

Call:  haplo.glm(formula = y ~ geno.glm, family = binomial, data = glm.data, 
    locus.label = locus.label, control = control, miss.val = miss.val)

Coefficients:
(Intercept)   geno.glm.1   geno.glm.2   geno.glm.3   geno.glm.4   geno.glm.5   geno.glm.6   geno.glm.7   geno.glm.8   geno.glm.9  
    -0.2922      -0.2110      -0.3188      -0.3611     -17.5139      -0.5967       0.3654       1.1913       0.3085       0.0131  
geno.glm.10  geno.glm.11  
    -0.9935      -0.7319  

Haplotypes:
            A B C hap.freq
geno.glm.1  A G C   0.0450
geno.glm.2  A G G   0.0954
geno.glm.3  A G T   0.1390
geno.glm.4  A T C   0.0145
geno.glm.5  A T G   0.0445
geno.glm.6  A T T   0.1392
geno.glm.7  T G C   0.0400
geno.glm.8  T G G   0.0826
geno.glm.9  T G T   0.1280
geno.glm.10 T T C   0.0280
geno.glm.11 T T G   0.0975
haplo.base  T T T   0.1463

Degrees of Freedom:  199 Total (i.e. Null);  188 Residual

     Null Deviance:  266 
 Residual Deviance:  244 
               AIC:  263 

>   print(cc.char.sim$score.lst, digits=3)
-------------------------------------------------------------------------------------------------------------------------------------------- 
                                                        Haplotype Effect Model: add                                                          
-------------------------------------------------------------------------------------------------------------------------------------------- 
-------------------------------------------------------------------------------------------------------------------------------------------- 
                                                          Global Score Statistics                                                            
-------------------------------------------------------------------------------------------------------------------------------------------- 

global-stat = 11.57, df = 11, p-val = 0.397

-------------------------------------------------------------------------------------------------------------------------------------------- 
                                                         Haplotype-specific Scores                                                           
-------------------------------------------------------------------------------------------------------------------------------------------- 

      A B C Hap-Freq Hap-Score p-val
 [1,] A T C 0.016    -1.264    0.206
 [2,] T T G 0.098    -1.131    0.258
 [3,] A T G 0.045    -0.951    0.341
 [4,] A G G 0.096    -0.843    0.399
 [5,] T T C 0.028    -0.8      0.424
 [6,] A G C 0.043    -0.657    0.511
 [7,] A G T 0.14     -0.371    0.711
 [8,] T G G 0.081    0.389     0.697
 [9,] T T T 0.147    0.55      0.583
[10,] A T T 0.137    0.848     0.397
[11,] T G T 0.129    1.097     0.273
[12,] T G C 0.04     1.996     0.046

> 
>     
> 
> proc.time()
   user  system elapsed 
 37.662   0.404  38.135 
